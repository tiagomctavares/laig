var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:(function(){try{var a=document.createElement('canvas');return !!(window.WebGLRenderingContext&&(a.getContext('webgl')||a.getContext('experimental-webgl')));}catch(b){return false;}})(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement('div');a.id='webgl-error-message';a.style.fontFamily='monospace';a.style.fontSize='13px';a.style.fontWeight='normal';a.style.textAlign='center';a.style.background='#fff';a.style.color='#000';a.style.padding='1.5em';a.style.width='400px';a.style.margin='5em auto 0';if(!this.webgl)a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join('\n'):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join('\n');return a;},addGetWebGLMessage:function(a){var b,c,d;a=a||{};b=a.parent!==undefined?a.parent:document.body;c=a.id!==undefined?a.id:'oldie';d=Detector.getWebGLErrorMessage();d.id=c;b.appendChild(d);}};if(typeof module==='object')module.exports=Detector;(function(){"use strict";var a={};if(typeof exports==='undefined')if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){a.exports={};define(function(){return a.exports;});}else a.exports=window;else a.exports=exports;(function(a){if(!b)var b=0.000001;if(!c)var c=(typeof Float32Array!=='undefined')?Float32Array:Array;var d={};d.setMatrixArrayType=function(a){c=a;};if(typeof a!=='undefined')a.glMatrix=d;;var e={};e.create=function(){var a=new c(2);a[0]=0;a[1]=0;return a;};e.clone=function(a){var b=new c(2);b[0]=a[0];b[1]=a[1];return b;};e.fromValues=function(a,b){var d=new c(2);d[0]=a;d[1]=b;return d;};e.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a;};e.set=function(a,b,c){a[0]=b;a[1]=c;return a;};e.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a;};e.subtract=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a;};e.sub=e.subtract;e.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return a;};e.mul=e.multiply;e.divide=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a;};e.div=e.divide;e.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a;};e.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);return a;};e.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a;};e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d);};e.dist=e.distance;e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d;};e.sqrDist=e.squaredDistance;e.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c);};e.len=e.length;e.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c;};e.sqrLen=e.squaredLength;e.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a;};e.normalize=function(a,b){var c=b[0],d=b[1];var e=c*c+d*d;if(e>0){e=1/Math.sqrt(e);a[0]=b[0]*e;a[1]=b[1]*e;}return a;};e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1];};e.cross=function(a,b,c){var d=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=d;return a;};e.lerp=function(a,b,c,d){var e=b[0],f=b[1];a[0]=e+d*(c[0]-e);a[1]=f+d*(c[1]-f);return a;};e.transformMat2=function(a,b,c){var d=b[0],e=b[1];a[0]=c[0]*d+c[2]*e;a[1]=c[1]*d+c[3]*e;return a;};e.transformMat2d=function(a,b,c){var d=b[0],e=b[1];a[0]=c[0]*d+c[2]*e+c[4];a[1]=c[1]*d+c[3]*e+c[5];return a;};e.transformMat3=function(a,b,c){var d=b[0],e=b[1];a[0]=c[0]*d+c[3]*e+c[6];a[1]=c[1]*d+c[4]*e+c[7];return a;};e.transformMat4=function(a,b,c){var d=b[0],e=b[1];a[0]=c[0]*d+c[4]*e+c[12];a[1]=c[1]*d+c[5]*e+c[13];return a;};e.forEach=(function(){var a=e.create();return function(b,c,d,e,f,g){var h,i;if(!c)c=2;if(!d)d=0;if(e)i=Math.min((e*c)+d,b.length);else i=b.length;for(h=d;h<i;h+=c){a[0]=b[h];a[1]=b[h+1];f(a,a,g);b[h]=a[0];b[h+1]=a[1];}return b;};})();e.str=function(a){return 'vec2('+a[0]+', '+a[1]+')';};if(typeof a!=='undefined')a.vec2=e;;var f={};f.create=function(){var a=new c(3);a[0]=0;a[1]=0;a[2]=0;return a;};f.clone=function(a){var b=new c(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b;};f.fromValues=function(a,b,d){var e=new c(3);e[0]=a;e[1]=b;e[2]=d;return e;};f.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a;};f.set=function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a;};f.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a;};f.subtract=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a;};f.sub=f.subtract;f.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a;};f.mul=f.multiply;f.divide=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a;};f.div=f.divide;f.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a;};f.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a;};f.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a;};f.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e);};f.dist=f.distance;f.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e;};f.sqrDist=f.squaredDistance;f.length=function(a){var b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d);};f.len=f.length;f.squaredLength=function(a){var b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d;};f.sqrLen=f.squaredLength;f.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a;};f.normalize=function(a,b){var c=b[0],d=b[1],e=b[2];var f=c*c+d*d+e*e;if(f>0){f=1/Math.sqrt(f);a[0]=b[0]*f;a[1]=b[1]*f;a[2]=b[2]*f;}return a;};f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];};f.cross=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];a[0]=e*i-f*h;a[1]=f*g-d*i;a[2]=d*h-e*g;return a;};f.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2];a[0]=e+d*(c[0]-e);a[1]=f+d*(c[1]-f);a[2]=g+d*(c[2]-g);return a;};f.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2];a[0]=c[0]*d+c[4]*e+c[8]*f+c[12];a[1]=c[1]*d+c[5]*e+c[9]*f+c[13];a[2]=c[2]*d+c[6]*e+c[10]*f+c[14];return a;};f.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;a[0]=k*j+n*-g+l*-i-m*-h;a[1]=l*j+n*-h+m*-g-k*-i;a[2]=m*j+n*-i+k*-h-l*-g;return a;};f.forEach=(function(){var a=f.create();return function(b,c,d,e,f,g){var h,i;if(!c)c=3;if(!d)d=0;if(e)i=Math.min((e*c)+d,b.length);else i=b.length;for(h=d;h<i;h+=c){a[0]=b[h];a[1]=b[h+1];a[2]=b[h+2];f(a,a,g);b[h]=a[0];b[h+1]=a[1];b[h+2]=a[2];}return b;};})();f.str=function(a){return 'vec3('+a[0]+', '+a[1]+', '+a[2]+')';};if(typeof a!=='undefined')a.vec3=f;;var g={};g.create=function(){var a=new c(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a;};g.clone=function(a){var b=new c(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b;};g.fromValues=function(a,b,d,e){var f=new c(4);f[0]=a;f[1]=b;f[2]=d;f[3]=e;return f;};g.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a;};g.set=function(a,b,c,d,e){a[0]=b;a[1]=c;a[2]=d;a[3]=e;return a;};g.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a;};g.subtract=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a;};g.sub=g.subtract;g.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a;};g.mul=g.multiply;g.divide=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a;};g.div=g.divide;g.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a;};g.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a;};g.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a;};g.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f);};g.dist=g.distance;g.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f;};g.sqrDist=g.squaredDistance;g.length=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e);};g.len=g.length;g.squaredLength=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e;};g.sqrLen=g.squaredLength;g.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a;};g.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3];var g=c*c+d*d+e*e+f*f;if(g>0){g=1/Math.sqrt(g);a[0]=b[0]*g;a[1]=b[1]*g;a[2]=b[2]*g;a[3]=b[3]*g;}return a;};g.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];};g.lerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];a[0]=e+d*(c[0]-e);a[1]=f+d*(c[1]-f);a[2]=g+d*(c[2]-g);a[3]=h+d*(c[3]-h);return a;};g.transformMat4=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g;a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g;a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g;a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g;return a;};g.transformQuat=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,m=j*f+g*e-h*d,n=-g*d-h*e-i*f;a[0]=k*j+n*-g+l*-i-m*-h;a[1]=l*j+n*-h+m*-g-k*-i;a[2]=m*j+n*-i+k*-h-l*-g;return a;};g.forEach=(function(){var a=g.create();return function(b,c,d,e,f,g){var h,i;if(!c)c=4;if(!d)d=0;if(e)i=Math.min((e*c)+d,b.length);else i=b.length;for(h=d;h<i;h+=c){a[0]=b[h];a[1]=b[h+1];a[2]=b[h+2];a[3]=b[h+3];f(a,a,g);b[h]=a[0];b[h+1]=a[1];b[h+2]=a[2];b[h+3]=a[3];}return b;};})();g.str=function(a){return 'vec4('+a[0]+', '+a[1]+', '+a[2]+', '+a[3]+')';};if(typeof a!=='undefined')a.vec4=g;;var h={};var i=new Float32Array([1,0,0,1]);h.create=function(){var a=new c(4);a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a;};h.clone=function(a){var b=new c(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b;};h.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a;};h.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a;};h.transpose=function(a,b){if(a===b){var c=b[1];a[1]=b[2];a[2]=c;}else{a[0]=b[0];a[1]=b[2];a[2]=b[1];a[3]=b[3];}return a;};h.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;if(!g)return null;g=1.0/g;a[0]=f*g;a[1]=-d*g;a[2]=-e*g;a[3]=c*g;return a;};h.adjoint=function(a,b){var c=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a;};h.determinant=function(a){return a[0]*a[3]-a[2]*a[1];};h.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3];var h=c[0],i=c[1],j=c[2],k=c[3];a[0]=d*h+e*j;a[1]=d*i+e*k;a[2]=f*h+g*j;a[3]=f*i+g*k;return a;};h.mul=h.multiply;h.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);a[0]=d*i+e*h;a[1]=d*-h+e*i;a[2]=f*i+g*h;a[3]=f*-h+g*i;return a;};h.scale=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1];a[0]=d*h;a[1]=e*i;a[2]=f*h;a[3]=g*i;return a;};h.str=function(a){return 'mat2('+a[0]+', '+a[1]+', '+a[2]+', '+a[3]+')';};if(typeof a!=='undefined')a.mat2=h;;var j={};var k=new Float32Array([1,0,0,1,0,0]);j.create=function(){var a=new c(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a;};j.clone=function(a){var b=new c(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b;};j.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a;};j.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a;};j.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5];var i=c*f-d*e;if(!i)return null;i=1.0/i;a[0]=f*i;a[1]=-d*i;a[2]=-e*i;a[3]=c*i;a[4]=(e*h-f*g)*i;a[5]=(d*g-c*h)*i;return a;};j.determinant=function(a){return a[0]*a[3]-a[1]*a[2];};j.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=c[0],k=c[1],l=c[2],m=c[3],n=c[4],o=c[5];a[0]=d*j+e*l;a[1]=d*k+e*m;a[2]=f*j+g*l;a[3]=f*k+g*m;a[4]=j*h+l*i+n;a[5]=k*h+m*i+o;return a;};j.mul=j.multiply;j.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=Math.sin(c),k=Math.cos(c);a[0]=d*k+e*j;a[1]=-d*j+e*k;a[2]=f*k+g*j;a[3]=-f*j+k*g;a[4]=k*h+j*i;a[5]=k*i-j*h;return a;};j.scale=function(a,b,c){var d=c[0],e=c[1];a[0]=b[0]*d;a[1]=b[1]*e;a[2]=b[2]*d;a[3]=b[3]*e;a[4]=b[4]*d;a[5]=b[5]*e;return a;};j.translate=function(a,b,c){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4]+c[0];a[5]=b[5]+c[1];return a;};j.str=function(a){return 'mat2d('+a[0]+', '+a[1]+', '+a[2]+', '+a[3]+', '+a[4]+', '+a[5]+')';};if(typeof a!=='undefined')a.mat2d=j;;var l={};var m=new Float32Array([1,0,0,0,1,0,0,0,1]);l.create=function(){var a=new c(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a;};l.clone=function(a){var b=new c(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b;};l.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a;};l.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a;};l.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=e;}else{a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8];}return a;};l.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;if(!o)return null;o=1.0/o;a[0]=l*o;a[1]=(-k*d+e*j)*o;a[2]=(h*d-e*g)*o;a[3]=m*o;a[4]=(k*c-e*i)*o;a[5]=(-h*c+e*f)*o;a[6]=n*o;a[7]=(-j*c+d*i)*o;a[8]=(g*c-d*f)*o;return a;};l.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];a[0]=(g*k-h*j);a[1]=(e*j-d*k);a[2]=(d*h-e*g);a[3]=(h*i-f*k);a[4]=(c*k-e*i);a[5]=(e*f-c*h);a[6]=(f*j-g*i);a[7]=(d*i-c*j);a[8]=(c*g-d*f);return a;};l.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h);};l.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];a[0]=m*d+n*g+o*j;a[1]=m*e+n*h+o*k;a[2]=m*f+n*i+o*l;a[3]=p*d+q*g+r*j;a[4]=p*e+q*h+r*k;a[5]=p*f+q*i+r*l;a[6]=s*d+t*g+u*j;a[7]=s*e+t*h+u*k;a[8]=s*f+t*i+u*l;return a;};l.mul=l.multiply;l.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];a[0]=d;a[1]=e;a[2]=f;a[3]=g;a[4]=h;a[5]=i;a[6]=m*d+n*g+j;a[7]=m*e+n*h+k;a[8]=m*f+n*i+l;return a;};l.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);a[0]=n*d+m*g;a[1]=n*e+m*h;a[2]=n*f+m*i;a[3]=n*g-m*d;a[4]=n*h-m*e;a[5]=n*i-m*f;a[6]=j;a[7]=k;a[8]=l;return a;};l.scale=function(a,b,c){var d=c[0],e=c[2];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=e*b[3];a[4]=e*b[4];a[5]=e*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a;};l.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a;};l.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;a[0]=1-(m+o);a[1]=k+r;a[2]=l-q;a[3]=k-r;a[4]=1-(j+o);a[5]=n+p;a[6]=l+q;a[7]=n-p;a[8]=1-(j+m);return a;};l.str=function(a){return 'mat3('+a[0]+', '+a[1]+', '+a[2]+', '+a[3]+', '+a[4]+', '+a[5]+', '+a[6]+', '+a[7]+', '+a[8]+')';};if(typeof a!=='undefined')a.mat3=l;;var n={};var o=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);n.create=function(){var a=new c(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a;};n.clone=function(a){var b=new c(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b;};n.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a;};n.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a;};n.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=f;a[11]=b[14];a[12]=e;a[13]=g;a[14]=h;}else{a[0]=b[0];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=b[1];a[5]=b[5];a[6]=b[9];a[7]=b[13];a[8]=b[2];a[9]=b[6];a[10]=b[10];a[11]=b[14];a[12]=b[3];a[13]=b[7];a[14]=b[11];a[15]=b[15];}return a;};n.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;if(!E)return null;E=1.0/E;a[0]=(h*D-i*C+j*B)*E;a[1]=(e*C-d*D-f*B)*E;a[2]=(p*x-q*w+r*v)*E;a[3]=(m*w-l*x-n*v)*E;a[4]=(i*A-g*D-j*z)*E;a[5]=(c*D-e*A+f*z)*E;a[6]=(q*u-o*x-r*t)*E;a[7]=(k*x-m*u+n*t)*E;a[8]=(g*C-h*A+j*y)*E;a[9]=(d*A-c*C-f*y)*E;a[10]=(o*w-p*u+r*s)*E;a[11]=(l*u-k*w-n*s)*E;a[12]=(h*z-g*B-i*y)*E;a[13]=(c*B-d*z+e*y)*E;a[14]=(p*t-o*v-q*s)*E;a[15]=(k*v-l*t+m*s)*E;return a;};n.adjoint=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];a[0]=(h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m));a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m));a[2]=(d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i));a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i));a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m));a[5]=(c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m));a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i));a[7]=(c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i));a[8]=(g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l));a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l));a[10]=(c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h));a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h));a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l));a[13]=(c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l));a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h));a[15]=(c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h));return a;};n.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15],r=b*g-c*f,s=b*h-d*f,t=b*i-e*f,u=c*h-d*g,v=c*i-e*g,w=d*i-e*h,x=j*o-k*n,y=j*p-l*n,z=j*q-m*n,A=k*p-l*o,B=k*q-m*o,C=l*q-m*p;return r*C-s*B+t*A+u*z-v*y+w*x;};n.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15];var t=c[0],u=c[1],v=c[2],w=c[3];a[0]=t*d+u*h+v*l+w*p;a[1]=t*e+u*i+v*m+w*q;a[2]=t*f+u*j+v*n+w*r;a[3]=t*g+u*k+v*o+w*s;t=c[4];u=c[5];v=c[6];w=c[7];a[4]=t*d+u*h+v*l+w*p;a[5]=t*e+u*i+v*m+w*q;a[6]=t*f+u*j+v*n+w*r;a[7]=t*g+u*k+v*o+w*s;t=c[8];u=c[9];v=c[10];w=c[11];a[8]=t*d+u*h+v*l+w*p;a[9]=t*e+u*i+v*m+w*q;a[10]=t*f+u*j+v*n+w*r;a[11]=t*g+u*k+v*o+w*s;t=c[12];u=c[13];v=c[14];w=c[15];a[12]=t*d+u*h+v*l+w*p;a[13]=t*e+u*i+v*m+w*q;a[14]=t*f+u*j+v*n+w*r;a[15]=t*g+u*k+v*o+w*s;return a;};n.mul=n.multiply;n.translate=function(a,b,c){var d=c[0],e=c[1],f=c[2],g,h,i,j,k,l,m,n,o,p,q,r;if(b===a){a[12]=b[0]*d+b[4]*e+b[8]*f+b[12];a[13]=b[1]*d+b[5]*e+b[9]*f+b[13];a[14]=b[2]*d+b[6]*e+b[10]*f+b[14];a[15]=b[3]*d+b[7]*e+b[11]*f+b[15];}else{g=b[0];h=b[1];i=b[2];j=b[3];k=b[4];l=b[5];m=b[6];n=b[7];o=b[8];p=b[9];q=b[10];r=b[11];a[0]=g;a[1]=h;a[2]=i;a[3]=j;a[4]=k;a[5]=l;a[6]=m;a[7]=n;a[8]=o;a[9]=p;a[10]=q;a[11]=r;a[12]=g*d+k*e+o*f+b[12];a[13]=h*d+l*e+p*f+b[13];a[14]=i*d+m*e+q*f+b[14];a[15]=j*d+n*e+r*f+b[15];}return a;};n.scale=function(a,b,c){var d=c[0],e=c[1],f=c[2];a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*f;a[9]=b[9]*f;a[10]=b[10]*f;a[11]=b[11]*f;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a;};n.rotate=function(a,c,d,e){var f=e[0],g=e[1],h=e[2],i=Math.sqrt(f*f+g*g+h*h),j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;if(Math.abs(i)<b)return null;i=1/i;f*=i;g*=i;h*=i;j=Math.sin(d);k=Math.cos(d);l=1-k;m=c[0];n=c[1];o=c[2];p=c[3];q=c[4];r=c[5];s=c[6];t=c[7];u=c[8];v=c[9];w=c[10];x=c[11];y=f*f*l+k;z=g*f*l+h*j;A=h*f*l-g*j;B=f*g*l-h*j;C=g*g*l+k;D=h*g*l+f*j;E=f*h*l+g*j;F=g*h*l-f*j;G=h*h*l+k;a[0]=m*y+q*z+u*A;a[1]=n*y+r*z+v*A;a[2]=o*y+s*z+w*A;a[3]=p*y+t*z+x*A;a[4]=m*B+q*C+u*D;a[5]=n*B+r*C+v*D;a[6]=o*B+s*C+w*D;a[7]=p*B+t*C+x*D;a[8]=m*E+q*F+u*G;a[9]=n*E+r*F+v*G;a[10]=o*E+s*F+w*G;a[11]=p*E+t*F+x*G;if(c!==a){a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];}return a;};n.rotateX=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];if(b!==a){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];}a[4]=f*e+j*d;a[5]=g*e+k*d;a[6]=h*e+l*d;a[7]=i*e+m*d;a[8]=j*e-f*d;a[9]=k*e-g*d;a[10]=l*e-h*d;a[11]=m*e-i*d;return a;};n.rotateY=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];if(b!==a){a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];}a[0]=f*e-j*d;a[1]=g*e-k*d;a[2]=h*e-l*d;a[3]=i*e-m*d;a[8]=f*d+j*e;a[9]=g*d+k*e;a[10]=h*d+l*e;a[11]=i*d+m*e;return a;};n.rotateZ=function(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];if(b!==a){a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];}a[0]=f*e+j*d;a[1]=g*e+k*d;a[2]=h*e+l*d;a[3]=i*e+m*d;a[4]=j*e-f*d;a[5]=k*e-g*d;a[6]=l*e-h*d;a[7]=m*e-i*d;return a;};n.fromRotationTranslation=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;a[0]=1-(n+p);a[1]=l+s;a[2]=m-r;a[3]=0;a[4]=l-s;a[5]=1-(k+p);a[6]=o+q;a[7]=0;a[8]=m+r;a[9]=o-q;a[10]=1-(k+n);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a;};n.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;a[0]=1-(m+o);a[1]=k+r;a[2]=l-q;a[3]=0;a[4]=k-r;a[5]=1-(j+o);a[6]=n+p;a[7]=0;a[8]=l+q;a[9]=n-p;a[10]=1-(j+m);a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a;};n.frustum=function(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);a[0]=(f*2)*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=(f*2)*i;a[6]=0;a[7]=0;a[8]=(c+b)*h;a[9]=(e+d)*i;a[10]=(g+f)*j;a[11]=-1;a[12]=0;a[13]=0;a[14]=(g*f*2)*j;a[15]=0;return a;};n.perspective=function(a,b,c,d,e){var f=1.0/Math.tan(b/2),g=1/(d-e);a[0]=f/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=f;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(e+d)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=(2*e*d)*g;a[15]=0;return a;};n.ortho=function(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);a[0]=-2*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*i;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*j;a[11]=0;a[12]=(b+c)*h;a[13]=(e+d)*i;a[14]=(g+f)*j;a[15]=1;return a;};n.lookAt=function(a,c,d,e){var f,g,h,i,j,k,l,m,o,p,q=c[0],r=c[1],s=c[2],t=e[0],u=e[1],v=e[2],w=d[0],x=d[1],y=d[2];if(Math.abs(q-w)<b&&Math.abs(r-x)<b&&Math.abs(s-y)<b)return n.identity(a);l=q-w;m=r-x;o=s-y;p=1/Math.sqrt(l*l+m*m+o*o);l*=p;m*=p;o*=p;f=u*o-v*m;g=v*l-t*o;h=t*m-u*l;p=Math.sqrt(f*f+g*g+h*h);if(!p){f=0;g=0;h=0;}else{p=1/p;f*=p;g*=p;h*=p;}i=m*h-o*g;j=o*f-l*h;k=l*g-m*f;p=Math.sqrt(i*i+j*j+k*k);if(!p){i=0;j=0;k=0;}else{p=1/p;i*=p;j*=p;k*=p;}a[0]=f;a[1]=i;a[2]=l;a[3]=0;a[4]=g;a[5]=j;a[6]=m;a[7]=0;a[8]=h;a[9]=k;a[10]=o;a[11]=0;a[12]=-(f*q+g*r+h*s);a[13]=-(i*q+j*r+k*s);a[14]=-(l*q+m*r+o*s);a[15]=1;return a;};n.str=function(a){return 'mat4('+a[0]+', '+a[1]+', '+a[2]+', '+a[3]+', '+a[4]+', '+a[5]+', '+a[6]+', '+a[7]+', '+a[8]+', '+a[9]+', '+a[10]+', '+a[11]+', '+a[12]+', '+a[13]+', '+a[14]+', '+a[15]+')';};if(typeof a!=='undefined')a.mat4=n;;var p={};var q=new Float32Array([0,0,0,1]);p.create=function(){var a=new c(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a;};p.clone=g.clone;p.fromValues=g.fromValues;p.copy=g.copy;p.set=g.set;p.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a;};p.setAxisAngle=function(a,b,c){c=c*0.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a;};p.add=g.add;p.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];a[0]=d*k+g*h+e*j-f*i;a[1]=e*k+g*i+f*h-d*j;a[2]=f*k+g*j+d*i-e*h;a[3]=g*k-d*h-e*i-f*j;return a;};p.mul=p.multiply;p.scale=g.scale;p.rotateX=function(a,b,c){c*=0.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);a[0]=d*i+g*h;a[1]=e*i+f*h;a[2]=f*i-e*h;a[3]=g*i-d*h;return a;};p.rotateY=function(a,b,c){c*=0.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);a[0]=d*i-f*h;a[1]=e*i+g*h;a[2]=f*i+d*h;a[3]=g*i-e*h;return a;};p.rotateZ=function(a,b,c){c*=0.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);a[0]=d*i+e*h;a[1]=e*i-d*h;a[2]=f*i+g*h;a[3]=g*i-f*h;return a;};p.calculateW=function(a,b){var c=b[0],d=b[1],e=b[2];a[0]=c;a[1]=d;a[2]=e;a[3]=-Math.sqrt(Math.abs(1.0-c*c-d*d-e*e));return a;};p.dot=g.dot;p.lerp=g.lerp;p.slerp=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=c[0],j=c[1],k=c[2],l=c[3];var m=e*i+f*j+g*k+h*l,n,o,p,q;if(Math.abs(m)>=1.0){if(a!==b){a[0]=e;a[1]=f;a[2]=g;a[3]=h;}return a;}n=Math.acos(m);o=Math.sqrt(1.0-m*m);if(Math.abs(o)<0.001){a[0]=(e*0.5+i*0.5);a[1]=(f*0.5+j*0.5);a[2]=(g*0.5+k*0.5);a[3]=(h*0.5+l*0.5);return a;}p=Math.sin((1-d)*n)/o;q=Math.sin(d*n)/o;a[0]=(e*p+i*q);a[1]=(f*p+j*q);a[2]=(g*p+k*q);a[3]=(h*p+l*q);return a;};p.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1.0/g:0;a[0]=-c*h;a[1]=-d*h;a[2]=-e*h;a[3]=f*h;return a;};p.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a;};p.length=g.length;p.len=p.length;p.squaredLength=g.squaredLength;p.sqrLen=p.squaredLength;p.normalize=g.normalize;p.fromMat3=(function(){var a=[1,2,0];return function(b,c){var d=c[0]+c[4]+c[8];var e;if(d>0.0){e=Math.sqrt(d+1.0);b[3]=0.5*e;e=0.5/e;b[0]=(c[7]-c[5])*e;b[1]=(c[2]-c[6])*e;b[2]=(c[3]-c[1])*e;}else{var f=0;if(c[4]>c[0])f=1;if(c[8]>c[f*3+f])f=2;var g=a[f];var h=a[g];e=Math.sqrt(c[f*3+f]-c[g*3+g]-c[h*3+h]+1.0);b[f]=0.5*e;e=0.5/e;b[3]=(c[h*3+g]-c[g*3+h])*e;b[g]=(c[g*3+f]+c[f*3+g])*e;b[h]=(c[h*3+f]+c[f*3+h])*e;}return b;};})();p.str=function(a){return 'quat('+a[0]+', '+a[1]+', '+a[2]+', '+a[3]+')';};if(typeof a!=='undefined')a.quat=p;;})(a.exports);})();function setProperty(a,b,c){var d=b.split(/[\.\[\]]/).filter(function(a){return a.length>0;});var e=a;for(var f=0;f<d.length-1;++f){if(e[d[f]]===undefined)e[d[f]]={};e=e[d[f]];}e[d[d.length-1]]=c;}function getStringFromUrl(a){var b=new XMLHttpRequest();b.open("GET",a,false);b.send();return b.responseText;}function CGFshader(a,b,c){this.gl=a;this.uniforms={};this.attributes={};if(b!=undefined&&c!=undefined)this.init(b,c);}CGFshader.prototype.init=function(a,b){var c=getStringFromUrl(b);var d=getStringFromUrl(a);var e=this.createShaderFromSource(WebGLRenderingContext.FRAGMENT_SHADER,c);var f=this.createShaderFromSource(WebGLRenderingContext.VERTEX_SHADER,d);this.compile_program(f,e);};CGFshader.prototype.createShaderFromSource=function(a,b){var c=this.gl.createShader(a);this.gl.shaderSource(c,b);this.gl.compileShader(c);if(!this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS)){alert(this.gl.getShaderInfoLog(c));return null;}return c;};CGFshader.prototype.compile_program=function(a,b){var c=this.gl;var d=c.createProgram();c.attachShader(d,a);c.attachShader(d,b);c.linkProgram(d);if(!c.getProgramParameter(d,c.LINK_STATUS)){console.log(c.getProgramInfoLog(d));alert('Could not initialise shaders');}this.program=d;c.useProgram(d);this.uniforms={};var e=c.getProgramParameter(d,c.ACTIVE_UNIFORMS);for(var f=0;f<e;++f){var g=c.getActiveUniform(d,f);var h=c.getUniformLocation(d,g.name);setProperty(this.uniforms,g.name,h);}this.attributes={};var i=c.getProgramParameter(d,c.ACTIVE_ATTRIBUTES);for(var f=0;f<i;++f){var j=c.getActiveAttrib(d,f);var h=c.getAttribLocation(d,j.name);setProperty(this.attributes,j.name,h);}};CGFshader.prototype.update=function(){};CGFshader.prototype.bind=function(){this.gl.useProgram(this.program);};CGFshader.prototype.unbind=function(){this.gl.useProgram(null);};CGFshader.prototype.copyValues=function(a){for(a in this.attributes)console.log("Attr: "+a+" - "+this.attributes[a]);iterateUniforms(this.uniforms,this.gl,this.program);};function iterateUniforms(a,b,c){for(u in a){console.log("Uniform: "+u+" - "+typeof a[u]);if(a[u] instanceof WebGLUniformLocation)console.log(" - "+b.getUniform(c,a[u]));else iterateUniforms(a[u],b,c);};}function CGFtexture(a,b){this.scene=a;this.texID=-1;this.gl=a.gl;this.image=new Image();this.image.crossOrigin="anonymous";var c=this;this.image.onload=function(){console.log("Texture loaded: "+c.image.src);c.texID=c.gl.createTexture();c.gl.bindTexture(c.gl.TEXTURE_2D,c.texID);c.gl.texImage2D(c.gl.TEXTURE_2D,0,c.gl.RGBA,c.gl.RGBA,c.gl.UNSIGNED_BYTE,c.image);c.gl.texParameteri(c.gl.TEXTURE_2D,c.gl.TEXTURE_MAG_FILTER,c.gl.LINEAR);if(isPowerOfTwo(c.image.width)&&isPowerOfTwo(c.image.height))c.gl.texParameteri(c.gl.TEXTURE_2D,c.gl.TEXTURE_MIN_FILTER,c.gl.LINEAR);else{c.gl.texParameteri(c.gl.TEXTURE_2D,c.gl.TEXTURE_MIN_FILTER,c.gl.LINEAR);c.gl.texParameteri(c.gl.TEXTURE_2D,c.gl.TEXTURE_WRAP_S,c.gl.CLAMP_TO_EDGE);c.gl.texParameteri(c.gl.TEXTURE_2D,c.gl.TEXTURE_WRAP_T,c.gl.CLAMP_TO_EDGE);}};this.image.src=b;}function isPowerOfTwo(a){return(a&(a-1))==0;}CGFtexture.prototype.bind=function(){if(this.texID!=-1){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texID);this.scene.activeTexture=this;return true;}else return false;};CGFtexture.prototype.unbind=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.scene.activeTexture=null;};function CGFappearance(a){this.scene=a;this.ambient=vec4.fromValues(0.2,0.2,0.2,1.0);this.diffuse=vec4.fromValues(0.5,0.5,0.5,1.0);this.specular=vec4.fromValues(0.5,0.5,0.5,1.0);this.shininess=10.0;this.emission=vec4.fromValues(0,0,0,1);}CGFappearance.prototype.constructor=CGFappearance;CGFappearance.prototype.setAmbient=function(a,b,c,d){vec4.set(this.ambient,a,b,c,d);};CGFappearance.prototype.setDiffuse=function(a,b,c,d){vec4.set(this.diffuse,a,b,c,d);};CGFappearance.prototype.setSpecular=function(a,b,c,d){vec4.set(this.specular,a,b,c,d);};CGFappearance.prototype.setShininess=function(a){this.shininess=a;};CGFappearance.prototype.setEmission=function(a,b,c,d){vec4.set(this.emission,a,b,c,d);};CGFappearance.prototype.setColor=function(a,b,c,d){this.setAmbient(a,b,c,d);this.setDiffuse(a,b,c,d);};CGFappearance.prototype.apply=function(){this.scene.setAmbient(this.ambient[0],this.ambient[1],this.ambient[2],this.ambient[3]);this.scene.setDiffuse(this.diffuse[0],this.diffuse[1],this.diffuse[2],this.diffuse[3]);this.scene.setSpecular(this.specular[0],this.specular[1],this.specular[2],this.specular[3]);this.scene.setShininess(this.shininess);this.scene.setEmission(this.emission[0],this.emission[1],this.emission[2],this.emission[3]);if(this.texture){if(this.texture.bind()&&this.wrapS&&this.wrapT){var a=this.scene.gl;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,this.wrapS);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,this.wrapT);this.scene.activeTexture=this.texture;}}else this.scene.activeTexture=null;};CGFappearance.prototype.setTexture=function(a){this.texture=a;};CGFappearance.prototype.loadTexture=function(a){this.texture=new CGFtexture(this.scene,a);};CGFappearance.prototype.setTextureWrap=function(a,b){this.wrapS=this.scene.gl[a];this.wrapT=this.scene.gl[b];};function CGFobject(a){this.scene=a;this.inited=false;this.primitiveType=this.scene.gl.TRIANGLES;};CGFobject.prototype.constructor=CGFobject;CGFobject.prototype.display=function(){this.drawElements(this.primitiveType);};CGFobject.prototype.initGLBuffers=function(){var a=this.scene.gl;this.vertsBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.vertsBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertices),a.STATIC_DRAW);if(!this.normals)this.normals=Array.apply(null,new Array(this.vertices.length)).map(function(){return 1.0;});this.normsBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.normsBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.normals),a.STATIC_DRAW);this.indicesBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),a.STATIC_DRAW);if(!this.texCoords)this.hasTexCoords=false;else{this.hasTexCoords=true;this.texCoordsBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.texCoordsBuffer);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.texCoords),a.STATIC_DRAW);};this.indicesBuffer.numValues=this.indices.length;a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);this.inited=true;};CGFobject.prototype.initBuffers=function(){this.vertices=[-0.5,-0.5,0,0.5,-0.5,0,-0.5,0.5,0,0.5,0.5,0];this.indices=[0,1,2,3];this.normals=[0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0,0.0,0.0,1.0];this.primitiveType=this.scene.gl.TRIANGLE_STRIP;this.initGLBuffers();};CGFobject.prototype.drawElements=function(a){var b=mat4.create();var c=this.scene.shader;var d=this.scene.gl;mat4.copy(b,this.scene.activeMatrix);mat4.invert(b,b);mat4.transpose(b,b);d.uniformMatrix4fv(c.uniforms.uMVMatrix,false,this.scene.activeMatrix);d.enableVertexAttribArray(c.attributes.aVertexPosition);d.bindBuffer(d.ARRAY_BUFFER,this.vertsBuffer);d.vertexAttribPointer(c.attributes.aVertexPosition,3,d.FLOAT,false,0,0);d.enableVertexAttribArray(c.attributes.aVertexNormal);d.uniformMatrix4fv(c.uniforms.uNMatrix,false,b);d.bindBuffer(d.ARRAY_BUFFER,this.normsBuffer);d.vertexAttribPointer(c.attributes.aVertexNormal,3,d.FLOAT,false,0,0);var e=this.scene.texturesEnabled;if(this.hasTexCoords&&e&&this.scene.activeTexture){d.enableVertexAttribArray(c.attributes.aTextureCoord);d.bindBuffer(d.ARRAY_BUFFER,this.texCoordsBuffer);d.vertexAttribPointer(c.attributes.aTextureCoord,2,d.FLOAT,false,0,0);}else{this.scene.enableTextures(false);d.disableVertexAttribArray(c.attributes.aTextureCoord);};d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);d.drawElements(a,this.indicesBuffer.numValues,d.UNSIGNED_SHORT,0);d.bindBuffer(d.ARRAY_BUFFER,null);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null);this.scene.enableTextures(e);};function CGFaxis(a,b,c){CGFobject.call(this,a);this.length=5;this.thickness=0.05;switch(arguments.length){case 3:this.thickness=c;case 2:this.length=height;}this.HALF_PI=3.1415926536/2;this.pyr=new CGFquadPyramid(a,this.length-this.thickness/2.0,this.thickness);};CGFaxis.prototype=Object.create(CGFobject.prototype);CGFaxis.prototype.constructor=CGFaxis;CGFaxis.prototype.display=function(){this.scene.pushMatrix();this.scene.setShininess(100.0);this.scene.setAmbient(1,1,1,1);this.scene.pushMatrix();this.scene.translate(0,0,this.thickness/2.0);this.scene.setDiffuse(0,0,1,1);this.scene.setSpecular(0,0,1,1);this.pyr.display();this.scene.popMatrix();this.scene.pushMatrix();this.scene.rotate(this.HALF_PI,0,1,0);this.scene.translate(0,0,this.thickness/2.0);this.scene.setDiffuse(1,0,0,1);this.scene.setSpecular(1,0,0,1);this.pyr.display();this.scene.popMatrix();this.scene.pushMatrix();this.scene.rotate(-this.HALF_PI,1,0,0);this.scene.translate(0,0,this.thickness/2.0);this.scene.setDiffuse(0,1,0,1);this.scene.setSpecular(0,1,0,1);this.pyr.display();this.scene.popMatrix();this.scene.popMatrix();};function CGFquadPyramid(a,b,c){CGFobject.call(this,a);this.halfSide=c/2;this.height=b;this.initBuffers();};CGFquadPyramid.prototype=Object.create(CGFobject.prototype);CGFquadPyramid.prototype.constructor=CGFquadPyramid;CGFquadPyramid.prototype.initBuffers=function(){this.vertices=[-this.halfSide,-this.halfSide,0,this.halfSide,-this.halfSide,0,-this.halfSide,this.halfSide,0,this.halfSide,this.halfSide,0,0,0,this.height];this.indices=[2,1,0,1,2,3,0,1,4,1,3,4,2,0,4,3,2,4];this.primitiveType=this.scene.gl.TRIANGLES;this.initGLBuffers();};function CGFinterface(){this.mouse=vec2.create();this.prevMouse=vec2.create();this.mouseButtons=[false,false,false];this.activeCamera=null;this.ctrlKey=false;}CGFinterface.prototype.init=function(a){console.log("Initializing Interface");this.scene=a.scene;var b=a.gl.canvas;b.tabIndex=1;var c=this;b.oncontextmenu=function(a){return false;};b.addEventListener("mousedown",function(a){a.preventDefault();a.stopPropagation();c.processMouseDown(a);});b.addEventListener("mouseup",function(a){a.preventDefault();a.stopPropagation();c.processMouseUp(a);});b.addEventListener("mousemove",function(a){a.preventDefault();a.stopPropagation();c.processMouseMove(a);});b.addEventListener("touchstart",function(a){a.preventDefault();a.stopPropagation();c.processTouchStart(a);});b.addEventListener("touchend",function(a){a.preventDefault();a.stopPropagation();c.processTouchEnd(a);});b.addEventListener("touchmove",function(a){a.preventDefault();a.stopPropagation();c.processTouchMove(a);});document.onkeypress=function(a){a.preventDefault();a.stopPropagation();c.processKeyboard(a);};return true;};CGFinterface.prototype.update=function(){};CGFinterface.prototype.processKeyboard=function(a){console.log('keydown');};CGFinterface.prototype.setActiveCamera=function(a){this.activeCamera=a;};CGFinterface.prototype.processMouseDown=function(a){var b=a.which;this.mouseButtons[b-1]=true;this.mouse[0]=a.pageX;this.mouse[1]=a.pageY;this.prevMouse[0]=this.mouse[0];this.prevMouse[1]=this.mouse[1];this.ctrlKey=a.ctrlKey;};CGFinterface.prototype.processMouseUp=function(a){var b=a.which;this.mouseButtons[b-1]=false;this.prevMouse[0]=this.mouse[0];this.prevMouse[1]=this.mouse[1];this.mouse[0]=a.pageX;this.mouse[1]=a.pageY;this.ctrlKey=a.ctrlKey;};CGFinterface.prototype.processMouseMove=function(a){this.prevMouse[0]=this.mouse[0];this.prevMouse[1]=this.mouse[1];this.mouse[0]=a.pageX;this.mouse[1]=a.pageY;this.processMouse();};CGFinterface.prototype.processMouse=function(){if(this.activeCamera){var a=vec2.subtract(vec2.create(),this.mouse,this.prevMouse);if(this.mouseButtons[0])if(this.ctrlKey)this.activeCamera.zoom(a[1]*0.05);else{this.activeCamera.orbit(CGFcameraAxisID.X,a[1]*Math.PI/180.0);this.activeCamera.orbit(CGFcameraAxisID.Y,-a[0]*Math.PI/180.0);}else if(this.mouseButtons[2])this.activeCamera.pan([-a[0]*0.05,a[1]*0.05,0]);else if(this.mouseButtons[1])this.activeCamera.zoom(a[1]*0.05);}};CGFinterface.prototype.processTouchStart=function(a){this.touches=a.targetTouches;this.prevTouches=this.touches;};CGFinterface.prototype.processTouchEnd=function(a){this.prevTouches=this.touches;this.touches=a.targetTouches;};CGFinterface.prototype.processTouchMove=function(a){this.prevTouches=this.touches;this.touches=a.targetTouches;this.processTouches();};CGFinterface.prototype.processTouches=function(){if(this.activeCamera)if(this.touches.length==1){var a=[this.prevTouches[0].pageX,this.prevTouches[0].pageY];var b=[this.touches[0].pageX,this.touches[0].pageY];var c=vec2.subtract(vec2.create(),b,a);this.activeCamera.orbit(CGFcameraAxisID.X,c[1]*Math.PI/180.0);this.activeCamera.orbit(CGFcameraAxisID.Y,-c[0]*Math.PI/180.0);}else{var d=[this.prevTouches[0].pageX,this.prevTouches[0].pageY];var e=[this.touches[0].pageX,this.touches[0].pageY];if(this.touches.length==2){var f=[this.prevTouches[1].pageX,this.prevTouches[1].pageY];var g=[this.touches[1].pageX,this.touches[1].pageY];var h=this.distanceBetweenPoints(d,f);var i=this.distanceBetweenPoints(e,g);var j=i-h;this.activeCamera.zoom(j*0.05);}else{var c=vec2.subtract(vec2.create(),e,d);this.activeCamera.pan([-c[0]*0.05,c[1]*0.05,0]);}}};CGFinterface.prototype.distanceBetweenPoints=function(a,b){return Math.sqrt((a[0]-b[0])*(a[0]-b[0])+(a[1]-b[1])*(a[1]-b[1]));};function CGFscene(){}CGFscene.prototype.init=function(a){console.log("Initializing Scene");this.gl=a.gl;this.pMatrix=mat4.create();this.activeMatrix=mat4.create();this.matrixStack=new Array();this.shader=new CGFshader(this.gl,'../lib/CGF/shaders/Gouraud/textured/multiple_light-vertex.glsl','../lib/CGF/shaders/Gouraud/textured/fragment.glsl');this.shader.bind();this.gl.activeTexture(this.gl.TEXTURE0);this.gl.uniform1i(this.shader.uniforms.uSampler,0);this.enableTextures(false);this.activeTexture=null;this.lights=new Array();var b=0;for(var c in this.shader.uniforms.uLight){this.lights[b]=new CGFlight(this,b);this.lights[b].disable();this.lights[b].update();b++;};this.gl.enable(this.gl.DEPTH_TEST);this.gl.depthFunc(this.gl.LEQUAL);this.setGlobalAmbientLight(0.1,0.1,0.1,1.0);return true;};CGFscene.prototype.enableTextures=function(a){this.shader.bind();this.texturesEnabled=a;this.gl.uniform1i(this.shader.uniforms.uUseTexture,a);};CGFscene.prototype.loadIdentity=function(){mat4.identity(this.activeMatrix);};CGFscene.prototype.pushMatrix=function(){this.matrixStack.push(this.activeMatrix);this.activeMatrix=mat4.clone(this.activeMatrix);};CGFscene.prototype.popMatrix=function(){this.activeMatrix=this.matrixStack.pop();};CGFscene.prototype.multMatrix=function(a){mat4.multiply(this.activeMatrix,this.activeMatrix,a);};CGFscene.prototype.translate=function(a,b,c){mat4.translate(this.activeMatrix,this.activeMatrix,[a,b,c]);};CGFscene.prototype.rotate=function(a,b,c,d){mat4.rotate(this.activeMatrix,this.activeMatrix,a,[b,c,d]);};CGFscene.prototype.scale=function(a,b,c){mat4.scale(this.activeMatrix,this.activeMatrix,[a,b,c]);};CGFscene.prototype.setAmbient=function(a,b,c,d){this.gl.uniform4fv(this.shader.uniforms.uFrontMaterial.ambient,[a,b,c,d]);};CGFscene.prototype.setDiffuse=function(a,b,c,d){this.gl.uniform4fv(this.shader.uniforms.uFrontMaterial.diffuse,[a,b,c,d]);};CGFscene.prototype.setSpecular=function(a,b,c,d){this.gl.uniform4fv(this.shader.uniforms.uFrontMaterial.specular,[a,b,c,d]);};CGFscene.prototype.setShininess=function(a){this.gl.uniform1f(this.shader.uniforms.uFrontMaterial.shininess,a);};CGFscene.prototype.setEmission=function(a,b,c,d){this.gl.uniform4fv(this.shader.uniforms.uFrontMaterial.emission,[a,b,c,d]);};CGFscene.prototype.updateProjectionMatrix=function(){this.pMatrix=this.camera.getProjectionMatrix(this.gl.canvas.width,this.gl.canvas.height);this.gl.uniformMatrix4fv(this.shader.uniforms.uPMatrix,false,this.pMatrix);};CGFscene.prototype.applyViewMatrix=function(){mat4.mul(this.activeMatrix,this.activeMatrix,this.camera.getViewMatrix());};CGFscene.prototype.update=function(){};CGFscene.prototype.display=function(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.clearColor(0.0,0.0,0.0,1.0);};CGFscene.prototype.setGlobalAmbientLight=function(a,b,c,d){this.shader.bind();this.gl.uniform4f(this.shader.uniforms.uGlobalAmbient,a,b,c,d);this.shader.unbind();};var CGFcameraAxis=Object.freeze({X:vec3.fromValues(1.0,0.0,0.0),Y:vec3.fromValues(0.0,1.0,0.0),Z:vec3.fromValues(0.0,0.0,1.0)});var CGFcameraAxisID=Object.freeze({X:0,Y:1,Z:2});function CGFcamera(a,b,c,d,e){this.fov=a;this.near=b;this.far=c;this.position=vec4.fromValues(d[0],d[1],d[2],0.0);this.target=vec4.fromValues(e[0],e[1],e[2],0.0);this.direction=this.calculateDirection();this._up=vec3.fromValues(0.0,1.0,0.0);this._viewMatrix=mat4.create();this._projectionMatrix=mat4.create();}CGFcamera.prototype.getViewMatrix=function(){mat4.lookAt(this._viewMatrix,this.position,this.target,this._up);return this._viewMatrix;};CGFcamera.prototype.getProjectionMatrix=function(a,b){var c=a/b;mat4.perspective(this._projectionMatrix,this.fov,c,this.near,this.far);return this._projectionMatrix;};CGFcamera.prototype.calculateDirection=function(){return vec4.normalize(vec4.create(),vec4.subtract(vec4.create(),this.target,this.position));};CGFcamera.prototype.setPosition=function(a){vec3.copy(this.position,a);this.direction=this.calculateDirection();};CGFcamera.prototype.setTarget=function(a){vec3.copy(this.target,a);this.direction=this.calculateDirection();};CGFcamera.prototype.translate=function(a){var b=vec4.scale(vec4.create(),this.direction,-a[2]);var c=vec4.fromValues(0.0,a[1],0.0,0.0);var d=vec3.create();vec3.scale(d,vec3.cross(d,vec3.fromValues(0,1,0),this.direction),a[0]);var e=vec4.fromValues(d[0],d[1],d[2],0);var f=vec4.create();f=vec4.add(f,b,vec4.add(f,c,e));vec4.add(this.position,this.position,f);vec4.add(this.target,this.position,this.direction);};CGFcamera.prototype.rotate=function(a,b){vec4.transformMat4(this.direction,this.direction,mat4.rotate(mat4.create(),mat4.create(),b,a));vec4.add(this.target,this.position,this.direction);};CGFcamera.prototype.orbit=function(a,b){var c=vec4.sub(vec4.create(),this.position,this.target);c[3]=0;var d;if(a==CGFcameraAxisID.X){var e=vec3.create();vec3.normalize(e,vec3.cross(e,c,this._up));var f=mat4.rotate(mat4.create(),mat4.create(),b,e);d=vec4.transformMat4(vec4.create(),c,f);vec3.normalize(this._up,vec3.cross(this._up,e,d));}else d=vec4.transformMat4(vec4.create(),c,mat4.rotate(mat4.create(),mat4.create(),b,this._up));vec4.add(this.position,this.target,d);this.direction=this.calculateDirection();};CGFcamera.prototype.pan=function(a){var b=0.05*vec3.distance(this.target,this.position);var c=vec3.cross(vec3.create(),this.direction,this._up);var d=vec4.scale(vec4.create(),vec3.normalize(c,c),a[0]*b);d[3]=0;var e=vec4.scale(vec4.create(),this._up,a[1]*b);e[3]=0;vec4.add(this.position,this.position,d);vec4.add(this.target,this.target,d);vec4.add(this.position,this.position,e);vec4.add(this.target,this.target,e);};CGFcamera.prototype.zoom=function(a){vec4.add(this.position,this.position,vec4.scale(vec4.create(),this.direction,a));};function CGFlight(a,b){CGFobject.call(this,a);this.scene=a;this.uLight=a.shader.uniforms.uLight[b];console.log("Created Light "+b);this.setPosition(0,0,0,1);this.setAmbient(0.1,0.1,0.1,1.0);this.setDiffuse(0.5,0.5,0.5,1.0);this.setSpecular(0.5,0.5,0.5,1.0);this.setSpotDirection(0,-1,0);this.setSpotExponent(10);this.setSpotCutOff(180);this.setConstantAttenuation(1);this.setLinearAttenuation(0);this.setQuadraticAttenuation(0);this.visible=false;this.initBuffers();};CGFlight.prototype=Object.create(CGFobject.prototype);CGFlight.prototype.constructor=CGFlight;CGFlight.prototype.initBuffers=function(){this.vertices=[-0.5,0,0,0,0.5,0,0.5,0,0,0,-0.5,0,0,0,0.5,0,0,-0.5];this.indices=[1,4,0,1,2,4,1,5,2,1,0,5,3,0,4,3,4,2,3,2,5,3,5,0];this.normals=[1,0,0,0,-1,0,-1,0,0,0,1,0,0,0,-1,0,0,1];this.primitiveType=this.scene.gl.TRIANGLES;this.initGLBuffers();};CGFlight.prototype.enable=function(){this.enabled=true;};CGFlight.prototype.disable=function(){this.enabled=false;};CGFlight.prototype.setPosition=function(a,b,c,d){this.position=[a,b,c,d];};CGFlight.prototype.setAmbient=function(a,b,c,d){this.ambient=[a,b,c,d];};CGFlight.prototype.setDiffuse=function(a,b,c,d){this.diffuse=[a,b,c,d];};CGFlight.prototype.setSpecular=function(a,b,c,d){this.specular=[a,b,c,d];};CGFlight.prototype.setSpotDirection=function(a,b,c){this.spot_direction=[a,b,c];};CGFlight.prototype.setSpotExponent=function(a){this.spot_exponent=a;};CGFlight.prototype.setSpotCutOff=function(a){this.spot_cutoff=a;};CGFlight.prototype.setConstantAttenuation=function(a){this.constant_attenuation=a;};CGFlight.prototype.setLinearAttenuation=function(a){this.linear_attenuation=a;};CGFlight.prototype.setQuadraticAttenuation=function(a){this.quadratic_attenuation=a;};CGFlight.prototype.update=function(){var a=this.scene.gl;var b=this.uLight;var c=[0,0,0,0];var d=[0,0,0];vec4.transformMat4(c,this.position,this.scene.activeMatrix);vec3.transformMat4(d,this.spot_direction,this.scene.activeMatrix);a.uniform1i(b.enabled,this.enabled);a.uniform4fv(b.position,c);a.uniform4fv(b.ambient,this.ambient);a.uniform4fv(b.diffuse,this.diffuse);a.uniform4fv(b.specular,this.specular);a.uniform3fv(b.spot_direction,d);a.uniform1f(b.spot_exponent,this.spot_exponent);a.uniform1f(b.spot_cutoff,this.spot_cutoff);a.uniform1f(b.constant_attenuation,this.constant_attenuation);a.uniform1f(b.linear_attenuation,this.linear_attenuation);a.uniform1f(b.quadratic_attenuation,this.quadratic_attenuation);if(this.visible){this.scene.setDiffuse(0.5,0.5,0.5,1);this.scene.pushMatrix();this.scene.translate(this.position[0],this.position[1],this.position[2]);this.scene.scale(0.3,0.3,0.3);this.display();this.scene.popMatrix();};};CGFlight.prototype.setVisible=function(a){this.visible=a;};function CGFapplication(a){this.element=a;this.initialized=false;this.gl=null;}CGFapplication.prototype.init=function(){if(this.initialized)return true;if(!Detector.webgl){Detector.addGetWebGLMessage({parent:this.element});return false;}var a=document.createElement("canvas");this.gl=a.getContext("webgl",{antialias:true})||a.getContext("experimental-webgl",{antialias:true});if(!this.gl){Detector.addGetWebGLMessage({parent:this.element});return false;}this.initialized=true;this.element.appendChild(this.gl.canvas);this.initScene();this.initInterface();window.addEventListener("resize",this.resizeCanvas(this.gl));this.resizeCanvas(this.gl)();return true;};CGFapplication.prototype.resizeCanvas=function(a){return function(){console.log("resize");if(!a)return;var b=window.innerWidth;var c=window.innerHeight;console.log("clientWidth: "+b+", clientHeight: "+c);if(a.canvas.width!=b||a.canvas.height!=c){console.log("width: "+a.canvas.width+", height: "+a.canvas.height);a.canvas.width=b;a.canvas.height=c;}};};CGFapplication.prototype.setScene=function(a){this.scene=a;if(this.initialized)this.scene.init(this);};CGFapplication.prototype.setInterface=function(a){this.interface=a;if(this.initialized)this.interface.init(this);};CGFapplication.prototype.initScene=function(){if(this.scene&&this.initialized)return this.scene.init(this);return false;};CGFapplication.prototype.initInterface=function(){if(this.interface&&this.initialized)return this.interface.init(this);return false;};CGFapplication.prototype.run=function(){var a=this;function b(){requestAnimationFrame(b,a.gl.canvas);if(a.interface)a.interface.update();if(a.scene){a.scene.update();a.scene.display();}}b();};function CGFplane(a,b){CGFobject.call(this,a);this.numDivisions=b?b+1.0:2.0;this.initBuffers();this.wireframe=false;}CGFplane.prototype=Object.create(CGFobject.prototype);CGFplane.prototype.constructor=CGFplane;CGFplane.prototype.initBuffers=function(){this.vertices=[];this.indices=[];this.normals=[];for(var a=0;a<this.numDivisions;++a)for(var b=0;b<this.numDivisions;++b){this.vertices.push(a);this.vertices.push(0);this.vertices.push(b);this.normals.push(0);this.normals.push(1);this.normals.push(0);}for(var a=0;a<this.numDivisions-1;++a)for(var b=0;b<this.numDivisions-1;++b){this.indices.push(b*this.numDivisions+a);this.indices.push(b*this.numDivisions+(a+1));this.indices.push((b+1)*this.numDivisions+a);this.indices.push(b*this.numDivisions+(a+1));this.indices.push((b+1)*this.numDivisions+(a+1));this.indices.push((b+1)*this.numDivisions+a);}this.primitiveType=this.scene.gl.TRIANGLE_STRIP;this.initGLBuffers();};CGFplane.prototype.display=function(){this.scene.pushMatrix();this.scene.translate(-0.5,0.0,-0.5);var a=1.0/(this.numDivisions-1);this.scene.scale(a,1.0,a);this.drawElements(this.primitiveType);this.scene.popMatrix();};